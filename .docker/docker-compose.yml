version: "3.8"

name: wild-tribes

services:

    db:
        image: postgres
        container_name: postgres_db
        restart: always
        ports:
            - "5432:5432"
        environment:
            - POSTGRES_DB=mcs_db
            - POSTGRES_USER=root
            - POSTGRES_PASSWORD=groot
            #        volumes:
#                -./postgres/init.sql:/docker-entrypoint-initdb.d/init.sql

    consul:
        image: consul:1.15
        ports:
            - "8500:8500"
            - "8600:8600/udp"
        command: "agent -server -ui -node=server-1 -bootstrap-expect=1 -client=0.0.0.0"
    
    prometheus:
        image: prom/prometheus
        container_name: prometheus
        network_mode: host    # while services are running from an IDE
        volumes:
            - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
        command:
            - --config.file=/etc/prometheus/prometheus.yml
        ports:
            - "9090:9090"

    grafana:
        # run monitoring/grafana/init.sh after first run to initialize datasource/dashboard
        image: grafana/grafana
        container_name: grafana
        network_mode: host    # while services are running from an IDE
        ports:
            - "3000:3000"
        # default username/password is admin/admin
        # uncomment the following for anonymous access on a local deployment:
        # environment:
        #     - GF_AUTH_ANONYMOUS_ENABLED=true
        #     - GF_AUTH_ANONYMOUS_ORG_ROLE=Admin

