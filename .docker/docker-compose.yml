version: "3.8"

name: wild-tribes

services:

    postgre-db:
        image: "postgres:alpine"
        environment:
            - POSTGRES_USER=quarkus
            - POSTGRES_PASSWORD=quarkus
            - POSTGRES_DB=wild_tribes_db
        healthcheck:
            test: [ "CMD-SHELL", "pg_isready -U notif_management_service -d notif_management" ]
            interval: 20s
            timeout: 15s
            retries: 10
        ports:
            - "5432:5432"
        networks:
            - application


    consul:
        image: consul:1.15
        ports:
            - "8500:8500"
            - "8600:8600/udp"
        command: "agent -server -ui -node=server-1 -bootstrap-expect=1 -client=0.0.0.0"
    
    prometheus:
        image: prom/prometheus
        container_name: prometheus
        network_mode: host    # while services are running from an IDE
        volumes:
            - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
        command:
            - --config.file=/etc/prometheus/prometheus.yml
        ports:
            - "9090:9090"

    grafana:
        # run monitoring/grafana/init.sh after first run to initialize datasource/dashboard
        image: grafana/grafana
        container_name: grafana
        network_mode: host    # while services are running from an IDE
        ports:
            - "3000:3000"
        # default username/password is admin/admin
        # uncomment the following for anonymous access on a local deployment:
        # environment:
        #     - GF_AUTH_ANONYMOUS_ENABLED=true
        #     - GF_AUTH_ANONYMOUS_ORG_ROLE=Admin

networks:
    application:
        driver: bridge
